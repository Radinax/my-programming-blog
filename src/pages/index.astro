---
import { getCollection } from 'astro:content';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import BaseLayout from '../layouts/BaseLayout.astro';

const posts = await getCollection('blog', ({ data }) => data.published)
const sortedPosts = [...posts].sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())

function getDateTime(date: Date){ 
  const year = date.getFullYear()
  const month = (date.getMonth() + 1).toString().padStart(2, '0')
  const day = date.getDate().toString().padStart(2, '0')
  return `${year}-${month}-${day}`
}
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}'>

  <div class="flex flex-col gap-16">
    {sortedPosts.map(post => 
    <article class="flex max-w-xl flex-col items-start justify-between">
                <div class="flex items-center gap-x-4 text-xs">
                  <time datetime={getDateTime(post.data.pubDate)} class="text-pine-dawn-muted dark:text-pine-muted">
                    {post.data.pubDate.toLocaleString('en', {
                     dateStyle: 'long',
                     })}
                  </time>
                  <a
                    href="#"
                    class="relative z-10 rounded-full dark:bg-pine-love bg-pine-dawn-iris text-white px-3 py-1.5 font-medium hover:opacity-80"
                  >
                    {post.data.category}
                  </a>
                </div>
                <div class="group relative">
                  <h3 class="mt-3 text-lg font-semibold leading-6 text-pine-dawn-text group-hover:text-gray-600 dark:text-pine-text">
                    <a href={`/blog/${post.slug}`}>
                      <span class="absolute inset-0" />
                      {post.data.title}
                    </a>
                  </h3>
                  <p class="mt-5 line-clamp-3 leading-6 text-pine-dawn-muted dark:text-pine-muted">{post.data.description}</p>
                </div>
                <div class="relative mt-8 flex items-center gap-x-4">
                  <img src="https://i1.sndcdn.com/avatars-000470714532-ryj8la-t500x500.jpg" alt="" class="h-10 w-10 rounded-full bg-gray-50" />
                  <div class="text-sm leading-6">
                    <p class="font-semibold text-pine-dawn-text dark:text-pine-text">
                      <span >
                        <span class="absolute inset-0" />
                        Hitokiri
                      </span>
                    </p>
                    <p class="dark:text-pine-muted text-pine-dawn-muted">Front-End Developer</p>
                  </div>
                </div>
              </article>
    )}
  </div>
</BaseLayout>
